<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sports Meet Registration - Sunrise English Private School</title>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-r from-indigo-50 to-blue-100 min-h-screen font-sans">

<!-- Registration Form -->
<div id="mainContainer" class="max-w-3xl mx-auto bg-white shadow-xl rounded-2xl mt-10 p-8 border border-blue-200">
  <h1 class="text-4xl font-bold text-center text-indigo-700 mb-4">SUNRISE ENGLISH PRIVATE SCHOOL - L.L.C - O.P.C- ABU DHBAI</h1>
  <h2 class="text-lg font-bold text-center text-gray-700 mb-8">ANNUAL SPORTS MEET 2025â€“2026 Registration</h2>

  <form id="sportsForm" class="space-y-6">
    <fieldset class="border border-gray-300 rounded-lg p-4">
      <legend class="font-semibold text-indigo-700">Student Information</legend>
      <div>
        <label class="block font-semibold text-gray-700">Full Name</label>
        <input type="text" id="name" class="border p-2 w-full rounded-md focus:ring-2 focus:ring-indigo-400" required>
      </div>
      <div class="grid grid-cols-2 gap-4 mt-2">
        <div>
          <label class="block font-semibold text-gray-700">GR Number</label>
          <input type="text" id="grNo" maxlength="5" class="border p-2 w-full rounded-md focus:ring-2 focus:ring-indigo-400" required>
        </div>
        <div>
          <label class="block font-semibold text-gray-700">Class</label>
          <input type="text" id="class" class="border p-2 w-full rounded-md focus:ring-2 focus:ring-indigo-400" required>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4 mt-2">
        <div>
          <label class="block font-semibold text-gray-700">Division</label>
          <input type="text" id="division" class="border p-2 w-full rounded-md focus:ring-2 focus:ring-indigo-400" required>
        </div>
        <div>
          <label class="block font-semibold text-gray-700">Sports House</label>
          <select id="house" class="border p-2 w-full rounded-md focus:ring-2 focus:ring-indigo-400" required>
            <option value="">Select House</option>
            <option value="Ruby">Ruby</option>
            <option value="Sapphire">Sapphire</option>
            <option value="Topaz">Topaz</option>
            <option value="Emerald">Emerald</option>
          </select>
        </div>
      </div>
    </fieldset>

    <fieldset class="border border-gray-300 rounded-lg p-4">
      <legend class="font-semibold text-indigo-700">Personal Details</legend>
      <div>
        <label class="block font-semibold text-gray-700">Date of Birth</label>
        <input type="date" id="dob" class="border p-2 w-full rounded-md focus:ring-2 focus:ring-indigo-400" required>
      </div>
      <div class="mt-2">
        <label class="block font-semibold text-gray-700">Category</label>
        <input type="text" id="category" class="border p-2 w-full rounded-md bg-gray-100 text-gray-600" readonly>
      </div>
    </fieldset>

    <fieldset id="eventsSection" class="hidden border border-gray-300 rounded-lg p-4">
      <legend class="font-semibold text-indigo-700">Select Events</legend>
      <div id="eventList" class="grid grid-cols-2 gap-2"></div>
      <p id="eventNote" class="text-sm text-gray-600 mt-2"></p>
    </fieldset>

    <button type="submit" class="mt-4 bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 w-full font-semibold">
      Submit Registration
    </button>
  </form>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden max-w-5xl mx-auto mt-10 bg-white p-6 rounded-2xl shadow-lg">
  <h2 class="text-2xl font-bold text-indigo-700 mb-4 text-center">Admin Panel - Sports Meet 2025</h2>
  <div class="flex flex-wrap justify-between mb-4 space-x-2">
    <select id="filterCategory" class="border p-2 rounded-md">
      <option value="">Select Category</option>
      <option value="Sub Junior">Sub Junior</option>
      <option value="Junior">Junior</option>
      <option value="Inter">Inter</option>
      <option value="Senior">Senior</option>
      <option value="Super Senior">Super Senior</option>
    </select>
    <select id="filterEvent" class="border p-2 rounded-md">
      <option value="">Select Event</option>
    </select>
    <button id="downloadFilteredPDF" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Download Filtered PDF</button>
    <button id="exportCSV" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Export to Excel</button>
    <button id="backToRegistration" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 ml-2">Back to Registration</button>
  </div>
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 text-sm">
      <thead class="bg-indigo-100">
        <tr>
          <th class="border px-2 py-1">Name</th>
          <th class="border px-2 py-1">GR No</th>
          <th class="border px-2 py-1">Class</th>
          <th class="border px-2 py-1">Div</th>
          <th class="border px-2 py-1">House</th>
          <th class="border px-2 py-1">Category</th>
          <th class="border px-2 py-1">Events</th>
          <th class="border px-2 py-1">Action</th>
        </tr>
      </thead>
      <tbody id="adminTable"></tbody>
    </table>
  </div>
</div>

<script>
const form = document.getElementById('sportsForm');
const dobInput = document.getElementById('dob');
const categoryField = document.getElementById('category');
const eventsSection = document.getElementById('eventsSection');
const eventList = document.getElementById('eventList');
const eventNote = document.getElementById('eventNote');

const categories = [
  { name: 'Sub Junior', limit: 2, min: new Date('2017-01-01') },
  { name: 'Junior', limit: 3, min: new Date('2015-01-01') },
  { name: 'Inter', limit: 3, min: new Date('2013-01-01') },
  { name: 'Senior', limit: 4, min: new Date('2010-01-01') },
  { name: 'Super Senior', limit: 4, min: new Date('2007-01-01') }
];

const eventsByCategory = {
  'Sub Junior': ['100 mts', '200 mts', 'Long Jump'],
  'Junior': ['100 mts', '200 mts', '400 mts', 'Long Jump'],
  'Inter': ['100 mts', '200 mts', '800 mts', 'Long Jump', 'Shot Put (4kg)'],
  'Senior': ['100 mts', '200 mts', '400 mts', '800 mts', 'Long Jump', 'Shot Put', '1500 mts'],
  'Super Senior': ['100 mts', '200 mts', '400 mts', '800 mts', 'Long Jump', 'Shot Put', '1500 mts']
};

const registeredGRs = new Set(JSON.parse(localStorage.getItem('registeredGRs') || '[]'));

// Category calculation
dobInput.addEventListener('change', () => {
  const birth = new Date(dobInput.value);
  let category = 'Super Senior';
  for (let c of categories) if (birth >= c.min) { category = c.name; break; }
  categoryField.value = category;

  eventsSection.classList.remove('hidden');
  eventList.innerHTML = '';
  const limit = categories.find(c => c.name === category).limit;
  eventNote.textContent = `You can select up to ${limit} events.`;

  eventsByCategory[category].forEach(ev => {
    const label = document.createElement('label');
    label.className = 'flex items-center space-x-2';
    label.innerHTML = `<input type='checkbox' value='${ev}' class='eventCheck'> <span>${ev}</span>`;
    eventList.appendChild(label);
  });

  document.querySelectorAll('.eventCheck').forEach(chk => {
    chk.addEventListener('change', () => {
      if (document.querySelectorAll('.eventCheck:checked').length > limit) {
        chk.checked = false;
        alert(`You can select only ${limit} events.`);
      }
    });
  });
});

// Submit registration
form.addEventListener('submit', e => {
  e.preventDefault();
  const gr = document.getElementById('grNo').value.trim();
  if (!/^[0-9]{5}$/.test(gr)) { alert('Invalid GR Number!'); return; }
  if (registeredGRs.has(gr)) { alert('This GR Number is already registered!'); return; }

  const selectedEvents = Array.from(document.querySelectorAll('.eventCheck:checked')).map(e => e.value);
  if (selectedEvents.length === 0) { alert('Select at least one event.'); return; }

  const student = {
    name: document.getElementById('name').value,
    grNo: gr,
    class: document.getElementById('class').value,
    division: document.getElementById('division').value,
    house: document.getElementById('house').value,
    dob: dobInput.value,
    category: categoryField.value,
    events: selectedEvents
  };

  const registrations = JSON.parse(localStorage.getItem('registrations') || '[]');
  registrations.push(student);
  localStorage.setItem('registrations', JSON.stringify(registrations));
  registeredGRs.add(gr);
  localStorage.setItem('registeredGRs', JSON.stringify(Array.from(registeredGRs)));

  generatePDF(student);
  alert('Registration successful! PDF is downloading...');
  form.reset(); categoryField.value = ''; eventsSection.classList.add('hidden');
});

// PDF generation
function generatePDF(data) {
  const content = document.createElement('div');
  content.style.padding = '20px';
  content.style.fontFamily = 'Arial,sans-serif';
  content.innerHTML = `
    <h2 style="text-align:center;">SUNRISE ENGLISH PRIVATE SCHOOL - L.L.C - O.P.C- ABU DHBAI</h2>
    <h3 style="text-align:center;">ANNUAL SPORTS MEET 2025-2026</h3>
    <p><strong>Full name:</strong> ${data.name}</p>
    <p><strong>Class:</strong> ${data.class}</p>
    <p><strong>Division:</strong> ${data.division}</p>
    <p><strong>Date of Birth:</strong> ${data.dob}</p>
    <p><strong>GR NO:</strong> ${data.grNo}</p>
    <p><strong>House:</strong> ${data.house}</p>
    <p><strong>Category:</strong> ${data.category}</p>
    <p><strong>Events:</strong></p><ul>${data.events.map(e => `<li>${e}</li>`).join('')}</ul>
  `;
  html2pdf().set({ margin: 10, filename: `${data.name}_SportsMeet2025.pdf` }).from(content).save();
}

// Admin button
const adminBtn = document.createElement('button');
adminBtn.textContent = 'Admin Panel';
adminBtn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg fixed top-5 right-5 z-50';
document.body.appendChild(adminBtn);

adminBtn.addEventListener('click', () => {
  const pass = prompt('Enter admin password:');
  if (pass !== 'SUN2025') { alert('Wrong password!'); return; }
  document.getElementById('mainContainer').classList.add('hidden');
  document.getElementById('adminPanel').classList.remove('hidden');
  loadAdminData();
});

// Load Admin Data
function loadAdminData() {
  const data = JSON.parse(localStorage.getItem('registrations') || '[]');
  const table = document.getElementById('adminTable');
  table.innerHTML = data.map((d, idx) => `
    <tr>
      <td class="border px-2 py-1">${d.name}</td>
      <td class="border px-2 py-1">${d.grNo}</td>
      <td class="border px-2 py-1">${d.class}</td>
      <td class="border px-2 py-1">${d.division}</td>
      <td class="border px-2 py-1">${d.house}</td>
      <td class="border px-2 py-1">${d.category}</td>
      <td class="border px-2 py-1">${d.events.join(', ')}</td>
      <td class="border px-2 py-1"><button class="bg-red-500 text-white px-2 py-1 rounded" onclick="removeRegistration(${idx})">Remove</button></td>
    </tr>`).join('');
}

// Remove registration
function removeRegistration(idx) {
  const data = JSON.parse(localStorage.getItem('registrations') || '[]');
  if (!confirm(`Remove registration of ${data[idx].name}?`)) return;
  const removedGR = data[idx].grNo;
  data.splice(idx, 1);
  localStorage.setItem('registrations', JSON.stringify(data));
  const grSet = new Set(JSON.parse(localStorage.getItem('registeredGRs') || '[]'));
  grSet.delete(removedGR);
  localStorage.setItem('registeredGRs', JSON.stringify(Array.from(grSet)));
  loadAdminData();
}

// Back to registration
document.getElementById('backToRegistration').addEventListener('click', () => {
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('mainContainer').classList.remove('hidden');
});
</script>
</body>
</html>
