<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sports Meet Registration - Sunrise English Private School</title>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC-axJOwivMy-bGhNmVIHaXORcG90gLA9g",
    authDomain: "registration-c78dc.firebaseapp.com",
    databaseURL: "https://registration-c78dc-default-rtdb.firebaseio.com",
    projectId: "registration-c78dc",
    storageBucket: "registration-c78dc.appspot.com",
    messagingSenderId: "368136278543",
    appId: "1:368136278543:web:03a46a62d1095f40a0497a"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  window.firebaseRefs = { database, ref, push, set, onValue, remove };
</script>
</head>
<body class="bg-gradient-to-r from-indigo-50 to-blue-100 min-h-screen font-sans">

<!-- Registration Form -->
<div id="mainContainer" class="max-w-3xl mx-auto bg-white shadow-xl rounded-2xl mt-10 p-8 border border-blue-200">
  <h1 class="text-3xl font-bold text-center text-indigo-700 mb-2">SUNRISE ENGLISH PRIVATE SCHOOL - L.L.C - O.P.C- ABU DHBAI</h1>
  <h2 class="text-lg font-bold text-center text-gray-700 mb-6">ANNUAL SPORTS MEET 2025â€“2026 Registration</h2>

  <form id="sportsForm" class="space-y-4">
    <div>
      <label class="block font-semibold text-gray-700">Full Name</label>
      <input type="text" id="name" class="border p-2 w-full rounded-md" required>
    </div>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold text-gray-700">GR Number</label>
        <input type="text" id="grNo" maxlength="5" class="border p-2 w-full rounded-md" required>
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Class</label>
        <input type="text" id="class" class="border p-2 w-full rounded-md" required>
      </div>
    </div>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold text-gray-700">Division</label>
        <input type="text" id="division" class="border p-2 w-full rounded-md" required>
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Sports House</label>
        <select id="house" class="border p-2 w-full rounded-md" required>
          <option value="">Select House</option>
          <option value="Ruby">Ruby</option>
          <option value="Sapphire">Sapphire</option>
          <option value="Topaz">Topaz</option>
          <option value="Emerald">Emerald</option>
        </select>
      </div>
    </div>
    <div>
      <label class="block font-semibold text-gray-700">Date of Birth</label>
      <input type="date" id="dob" class="border p-2 w-full rounded-md" required>
    </div>
    <div>
      <label class="block font-semibold text-gray-700">Category</label>
      <input type="text" id="category" class="border p-2 w-full rounded-md bg-gray-100" readonly>
    </div>

    <div id="eventsSection" class="hidden">
      <label class="block font-semibold text-gray-700 mt-2">Select Events</label>
      <div id="eventList" class="grid grid-cols-2 gap-2 mt-1"></div>
      <p id="eventNote" class="text-sm text-gray-600 mt-1"></p>
    </div>

    <button type="submit" class="mt-4 bg-indigo-600 text-white px-6 py-2 rounded-lg w-full">Submit Registration</button>
  </form>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden max-w-5xl mx-auto mt-10 bg-white p-6 rounded-2xl shadow-lg">
  <h2 class="text-2xl font-bold text-indigo-700 mb-4 text-center">Admin Panel</h2>
  <button id="backToRegistration" class="bg-gray-600 text-white px-4 py-2 rounded mb-4">Back to Registration</button>
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 text-sm">
      <thead class="bg-indigo-100">
        <tr>
          <th class="border px-2 py-1">Name</th>
          <th class="border px-2 py-1">GR No</th>
          <th class="border px-2 py-1">Class</th>
          <th class="border px-2 py-1">Division</th>
          <th class="border px-2 py-1">House</th>
          <th class="border px-2 py-1">Category</th>
          <th class="border px-2 py-1">Events</th>
          <th class="border px-2 py-1">Remove</th>
        </tr>
      </thead>
      <tbody id="adminTable"></tbody>
    </table>
  </div>
</div>

<script type="module">
import { database, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const form = document.getElementById('sportsForm');
const dobInput = document.getElementById('dob');
const categoryField = document.getElementById('category');
const eventsSection = document.getElementById('eventsSection');
const eventList = document.getElementById('eventList');
const eventNote = document.getElementById('eventNote');

const categories = [
  { name:'Sub Junior', limit:2, min:new Date('2017-01-01')},
  { name:'Junior', limit:3, min:new Date('2015-01-01')},
  { name:'Inter', limit:3, min:new Date('2013-01-01')},
  { name:'Senior', limit:4, min:new Date('2010-01-01')},
  { name:'Super Senior', limit:4, min:new Date('2007-01-01')}
];

const eventsByCategory = {
  'Sub Junior':['100 mts','200 mts','Long Jump'],
  'Junior':['100 mts','200 mts','400 mts','Long Jump'],
  'Inter':['100 mts','200 mts','800 mts','Long Jump','Shot Put (4kg)'],
  'Senior':['100 mts','200 mts','400 mts','800 mts','Long Jump','Shot Put','1500 mts'],
  'Super Senior':['100 mts','200 mts','400 mts','800 mts','Long Jump','Shot Put','1500 mts']
};

function getCategory(dob){
  const parts = dob.split('-');
  const birthDate = new Date(parts[0], parts[1]-1, parts[2]);
  for(let c of categories) if(birthDate >= c.min) return c.name;
  return 'Super Senior';
}

// Update events
dobInput.addEventListener('change', ()=>{
  const cat = getCategory(dobInput.value);
  categoryField.value = cat;
  eventsSection.classList.remove('hidden');
  eventList.innerHTML = '';
  const limit = categories.find(c=>c.name===cat).limit;
  eventNote.textContent = `You can select up to ${limit} events.`;
  eventsByCategory[cat].forEach(ev=>{
    const label = document.createElement('label');
    label.className='flex items-center space-x-2';
    label.innerHTML=`<input type="checkbox" value="${ev}" class="eventCheck"> <span>${ev}</span>`;
    eventList.appendChild(label);
  });
  document.querySelectorAll('.eventCheck').forEach(chk=>{
    chk.addEventListener('change',()=>{
      if(document.querySelectorAll('.eventCheck:checked').length>limit){chk.checked=false; alert(`You can select only ${limit} events.`);}
    });
  });
});

// Submit form
form.addEventListener('submit', e=>{
  e.preventDefault();
  const selectedEvents = Array.from(document.querySelectorAll('.eventCheck:checked')).map(e=>e.value);
  if(selectedEvents.length===0){alert("Select at least 1 event"); return;}
  const student = {
    name: document.getElementById('name').value,
    grNo: document.getElementById('grNo').value,
    class: document.getElementById('class').value,
    division: document.getElementById('division').value,
    house: document.getElementById('house').value,
    dob: dobInput.value,
    category: categoryField.value,
    events: selectedEvents
  };
  // Push to Firebase
  const newRef = push(ref(database, "registrations"));
  set(newRef, student);
  alert("Registration saved online! PDF will download now.");
  generatePDF(student);
  form.reset();
  categoryField.value='';
  eventsSection.classList.add('hidden');
});

// Generate PDF
function generatePDF(data){
  const content = document.createElement('div');
  content.style.padding='10px'; content.style.fontFamily='Arial, sans-serif'; content.style.fontSize='12px';
  content.innerHTML = `
    <div style="text-align:center; font-weight:bold;">SUNRISE ENGLISH PRIVATE SCHOOL - L.L.C - O.P.C- ABU DHBAI</div>
    <div style="text-align:center; font-weight:bold; margin-bottom:10px;">ANNUAL SPORTS MEET 2025-2026</div>
    <p>Dear Parents,</p>
    <p>Full Name: ${data.name}</p>
    <p>Class: ${data.class} | Division: ${data.division}</p>
    <p>Date of Birth: ${data.dob}</p>
    <p>GR No: ${data.grNo}</p>
    <p>Sports House: ${data.house}</p>
    <p>Category: ${data.category}</p>
    <p>Selected Events: ${data.events.join(', ')}</p>
  `;
  html2pdf().set({margin:10,filename:`${data.name}_SportsMeet2025.pdf`}).from(content).save();
}

// Admin panel
const adminPanel = document.getElementById('adminPanel');
const adminTable = document.getElementById('adminTable');
document.getElementById('backToRegistration').addEventListener('click',()=>{
  adminPanel.classList.add('hidden');
  document.getElementById('mainContainer').classList.remove('hidden');
});

// Admin button
const adminBtn = document.createElement('button');
adminBtn.innerText="Open Admin Panel";
adminBtn.className="fixed bottom-4 right-4 bg-red-600 text-white px-3 py-2 rounded-lg z-50";
document.body.appendChild(adminBtn);
adminBtn.addEventListener('click', ()=>{
  const pass = prompt("Enter Admin Password");
  if(pass==='SUN2025'){
    document.getElementById('mainContainer').classList.add('hidden');
    adminPanel.classList.remove('hidden');
    loadAdminData();
  } else alert("Incorrect Password");
});

function loadAdminData(){
  onValue(ref(database, "registrations"), snapshot=>{
    const data = snapshot.val();
    adminTable.innerHTML='';
    if(data){
      Object.entries(data).forEach(([key, d])=>{
        const tr = document.createElement('tr');
        tr.innerHTML=`
          <td class='border px-2 py-1'>${d.name}</td>
          <td class='border px-2 py-1'>${d.grNo}</td>
          <td class='border px-2 py-1'>${d.class}</td>
          <td class='border px-2 py-1'>${d.division}</td>
          <td class='border px-2 py-1'>${d.house}</td>
          <td class='border px-2 py-1'>${d.category}</td>
          <td class='border px-2 py-1'>${d.events.join(', ')}</td>
          <td class='border px-2 py-1'><button class='bg-red-500 text-white px-2 py-1 rounded'>Remove</button></td>
        `;
        tr.querySelector('button').addEventListener('click',()=>{
          if(confirm(`Remove ${d.name}?`)){
            remove(ref(database, "registrations/"+key));
          }
        });
        adminTable.appendChild(tr);
      });
    }
  });
}
</script>
</body>
</html>

